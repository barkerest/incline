<table id="dt-<%= plural_table_name %>" class="table" style="width: 100%;">
  <thead>
  <tr>
    <%- attributes.reject(&:password_digest?).each do |attribute| -%>
    <th><%= attribute.human_name %></th>
    <%- end -%>
    <th><%%= link_to 'New', new_<%= singular_table_name %>_path, class: 'btn btn-success btn-xs inline_form' %></th>
  </tr>
  </thead>
</table>

<%% provide :scripts do %>
<script type="text/javascript">
    //<![CDATA[
    $(function() {
        $('#dt-<%= plural_table_name %>').DataTable({
            dom: '<"panel-body"<"col-sm-6 col-sm-offset-6"fr>>t<"panel-body"<"col-sm-6"i><"col-sm-6"p>>',
            ajax: {
                url: '<%%= api_path %>',
                type: 'POST'
            },
            columns: [
                <%- attributes.reject(&:password_digest?).each do |attribute| -%>
                {
                    // how DT references the data.
                    data: '<%= attribute.name %>',
                    // how the server references the data.
                    name: '<%= attribute.name %>',
                    // override the default behavior as needed, or remove the render option for this column.
                    render: function(data, type) {
                        <%- if attribute.type == :integer -%>
                        return type === 'display' ? $.number(data) : data;
                        <%- elsif attribute.type == :float -%>
                        return type === 'display' ? $.number(data, 2) : data;
                        <%- elsif attribute.type == :datetime -%>
                        return type === 'display' ? '<span title="' + moment(data).format() + '">' + moment(data).format('YYYY-MM-DD') + '</span>' : data
                        <%- elsif attribute.type == :boolean -%>
                        if (type === 'display')
                            return data ? '<i class="glyphicon glyphicon-ok glyphicon-small"></i>' : '';
                        else
                            return data;
                        <%- else -%>
                        return data;
                        <%- end -%>
                    },
                    // can this column be used for sorting?
                    orderable: true,
                    // can this column be used for searching?
                    searchable: true
                },
                <%- end %>
                {
                    orderable: false,
                    searchable: false,
                    data: function (row, type, set, meta) {
                        if (type === 'display') {
                            var ret = '<div class="text-right">';

                            // the show icon.
                            ret += '<a href="javascript:inlineForm(\'' + row.DT_Path + '\')" title="Details" class="btn btn-default btn-xs"><i class="glyphicon glyphicon-zoom-in"></i></a>';

                            // the edit icon.
                            ret += '<a href="javascript:inlineForm(\'' + row.DT_Path + '/edit\')" title="Edit" class="btn btn-default btn-xs"><i class="glyphicon glyphicon-pencil"></i></a>';

                            // the delete icon.
                            ret += '<a href="javascript:inlineAction(\'' + row.DT_Path + '\',\'delete\')" title="Remove" class="btn btn-danger btn-xs" data-confirm="Are you sure you want to remove this <%= singular_table_name.humanize %>?"><i class="glyphicon glyphicon-trash"></i></a>';

                            ret += '</div>';
                            return ret;
                        } else {
                            return row.DT_Path;
                        }
                    }
                }
            ],
            responsive: true,
            serverSide: true
        });
    });
    //]]>
</script>
<%% end %>
